---
import AdminLayout from '../../layouts/AdminLayout.astro';
import { supabase } from '../../lib/supabase';

// 통계 데이터 가져오기
const { count: newsCount } = await supabase
  .from('news')
  .select('*', { count: 'exact', head: true });

const { data: recentNews } = await supabase
  .from('news')
  .select('*')
  .order('created_at', { ascending: false })
  .limit(5);
---

<AdminLayout title="대시보드">
  <div class="dashboard">
    <!-- Stats Cards -->
    <div class="stats-grid">
      <a href="/admin/news" class="stat-card">
        <div class="stat-info">
          <span class="stat-label">공지사항</span>
          <span class="stat-value">{newsCount || 0}</span>
        </div>
      </a>
      <a href="/admin/works" class="stat-card">
        <div class="stat-info">
          <span class="stat-label">인쇄가이드</span>
          <span class="stat-value">-</span>
        </div>
      </a>
      <a href="/admin/services" class="stat-card">
        <div class="stat-info">
          <span class="stat-label">서비스</span>
          <span class="stat-value">4</span>
        </div>
      </a>
      <a href="/admin/faq" class="stat-card">
        <div class="stat-info">
          <span class="stat-label">FAQ</span>
          <span class="stat-value">-</span>
        </div>
      </a>
    </div>

    <!-- Recent News -->
    <div class="dashboard-section">
      <div class="section-header">
        <h2>최근 공지사항</h2>
        <a href="/admin/news" class="view-all">전체보기 →</a>
      </div>
      <div class="recent-list">
        {recentNews && recentNews.length > 0 ? (
          recentNews.map((news) => (
            <a href={`/admin/news/${news.id}`} class="recent-item">
              <span class="recent-title">{news.title}</span>
              <span class="recent-date">{new Date(news.pub_date).toLocaleDateString('ko-KR')}</span>
            </a>
          ))
        ) : (
          <div class="empty-state">
            <p>등록된 공지사항이 없습니다.</p>
            <a href="/admin/news/new" class="btn-primary">공지사항 작성하기</a>
          </div>
        )}
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="dashboard-section">
      <h2>빠른 작업</h2>
      <div class="quick-actions">
        <a href="/admin/news/new" class="action-card">
          <span class="action-text">공지사항 작성</span>
        </a>
        <a href="/admin/works" class="action-card">
          <span class="action-text">인쇄가이드 관리</span>
        </a>
        <a href="/" target="_blank" class="action-card">
          <span class="action-text">사이트 보기</span>
        </a>
      </div>
    </div>
  </div>

  <style>
    .dashboard {
      max-width: 1200px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }

    .stat-card {
      background: var(--c-bg);
      border-radius: 12px;
      padding: 24px;
      text-decoration: none;
      box-shadow: var(--shadow-base);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .stat-info {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .stat-label {
      font-size: var(--fs-sm);
      color: var(--c-text-sub);
    }

    .stat-value {
      font-size: var(--fs-2xl);
      font-weight: 700;
      color: var(--c-text);
    }

    .dashboard-section {
      background: var(--c-bg);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: var(--shadow-base);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .section-header h2 {
      margin: 0;
      font-size: var(--fs-md);
      font-weight: 600;
      color: var(--c-text);
    }

    .view-all {
      color: var(--c-primary);
      text-decoration: none;
      font-size: var(--fs-sm);
    }

    .view-all:hover {
      text-decoration: underline;
    }

    .recent-list {
      display: flex;
      flex-direction: column;
    }

    .recent-item {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid var(--c-border-light);
      text-decoration: none;
      transition: background 0.2s;
    }

    .recent-item:last-child {
      border-bottom: none;
    }

    .recent-item:hover {
      background: var(--c-bg-secondary);
      margin: 0 -12px;
      padding: 12px;
      border-radius: 8px;
    }

    .recent-title {
      color: var(--c-text);
    }

    .recent-date {
      color: var(--c-text-light);
      font-size: var(--fs-sm);
    }

    .empty-state {
      text-align: center;
      padding: 32px;
      color: var(--c-text-sub);
    }

    .btn-primary {
      display: inline-block;
      background: var(--c-primary);
      color: var(--c-text-inverse);
      padding: 10px 20px;
      border-radius: 8px;
      text-decoration: none;
      margin-top: 12px;
      transition: background 0.2s;
    }

    .btn-primary:hover {
      background: var(--c-primary-light);
    }

    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 16px;
    }

    .action-card {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px 24px;
      background: var(--c-bg-secondary);
      border-radius: 12px;
      text-decoration: none;
      color: var(--c-text);
      transition: all 0.2s;
    }

    .action-card:hover {
      background: var(--c-border-light);
      transform: translateY(-2px);
    }

    .action-text {
      font-size: var(--fs-sm);
      font-weight: 500;
    }

    h2 {
      margin: 0 0 16px 0;
      font-size: var(--fs-md);
      font-weight: 600;
      color: var(--c-text);
    }
  </style>
</AdminLayout>
