---
import GithubIcon from "@/assets/icons/github.svg";
import InstagramIcon from "@/assets/icons/instagram.svg";
import LinkedinIcon from "@/assets/icons/linkedin.svg";
import TwitterIcon from "@/assets/icons/twitter.svg";
import YoutubeIcon from "@/assets/icons/youtube.svg";
import Container from "@/components/layout/Container.astro";
import SiteLogo from "@/components/ui/SiteLogo.astro";
import menuData from "@/config/menu.json";
import siteConfig from "@/config/site.config.json";
import socialData from "@/config/social.json";
import { supabase } from "@/lib/supabase";
import type { MenuData, SiteConfig, SocialMedia } from "@/types/index.d.ts";

const typedMenuData = menuData as MenuData;
const typedSiteConfig = siteConfig as SiteConfig;
const typedSocialData = socialData as SocialMedia[];

const footerMenus = typedMenuData.footer;

// DB에서 사업장 정보 가져오기
const { data: siteSettings } = await supabase
  .from("site_settings")
  .select("key, value")
  .in("key", [
    "company_name",
    "ceo_name",
    "business_number",
    "ecommerce_license",
    "privacy_officer",
    "phone",
    "email",
    "address",
    "google_maps_url",
    "business_hours",
    "business_hours_weekend",
    "bank_name",
    "bank_account",
    "bank_account_holder",
  ]);

// 설정을 객체로 변환
const settings: Record<string, string> = {};
siteSettings?.forEach((item) => {
  settings[item.key] = item.value || "";
});

type IconComponent = typeof GithubIcon;

const iconMap: Record<string, IconComponent> = {
  github: GithubIcon,
  twitter: TwitterIcon,
  linkedin: LinkedinIcon,
  youtube: YoutubeIcon,
  instagram: InstagramIcon,
};
---

<footer class="footer">
  <Container>
    <div class="footer-inner">
      <div class="footer-info">
        <SiteLogo class="footer-logo" inverse />

        <!-- 회사 정보 -->
        <div class="company-info">
          {
            settings.company_name && (
              <p class="info-item">
                <strong>{settings.company_name}</strong>
              </p>
            )
          }
          {
            settings.ceo_name && (
              <p class="info-item">대표: {settings.ceo_name}</p>
            )
          }
          {
            settings.business_number && (
              <p class="info-item">
                사업자등록번호: {settings.business_number}
              </p>
            )
          }
          {
            settings.ecommerce_license && (
              <p class="info-item">
                통신판매업신고: {settings.ecommerce_license}
              </p>
            )
          }
          {
            settings.privacy_officer && (
              <p class="info-item">
                개인정보관리책임자: {settings.privacy_officer}
              </p>
            )
          }
          {
            settings.phone && (
              <p class="info-item">
                <a
                  href={`tel:${settings.phone.replace(/-/g, "")}`}
                  class="info-link"
                >
                  전화: {settings.phone}
                </a>
              </p>
            )
          }
          {
            settings.email && (
              <p class="info-item">
                <a href={`mailto:${settings.email}`} class="info-link">
                  이메일: {settings.email}
                </a>
              </p>
            )
          }
          {
            settings.address && (
              <p class="info-item">
                {settings.google_maps_url ? (
                  <a
                    href={settings.google_maps_url}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="info-link"
                  >
                    주소: {settings.address}
                  </a>
                ) : (
                  `주소: ${settings.address}`
                )}
              </p>
            )
          }
        </div>

        <!-- 운영시간 -->
        {
          (settings.business_hours || settings.business_hours_weekend) && (
            <div class="business-hours">
              <p class="footer-business-hours">
                영업시간: {settings.business_hours}
                {settings.business_hours_weekend && (
                  <span class="business-hours-note">
                    {" "}
                    ({settings.business_hours_weekend})
                  </span>
                )}
              </p>
            </div>
          )
        }

        <!-- 계좌 정보 -->
        {
          settings.bank_account && (
            <div class="bank-info">
              <p class="info-item">
                {settings.bank_name && `${settings.bank_name} `}
                {settings.bank_account}
                {settings.bank_account_holder &&
                  ` ${settings.bank_account_holder}`}
              </p>
            </div>
          )
        }

        <!-- 소셜 미디어 -->
        <ul class="footer-social">
          {
            typedSocialData.map((social) => {
              const Icon = iconMap[social.icon];
              return (
                <li class="social-item">
                  <a
                    href={social.url}
                    class="social-link"
                    aria-label={social.label}
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    <Icon width={20} height={20} />
                  </a>
                </li>
              );
            })
          }
        </ul>
      </div>

      <nav class="footer-nav">
        {
          footerMenus.map((group) => (
            <div class="nav-group">
              <h3 class="nav-group-title">{group.name}</h3>
              <ul class="nav-group-list">
                {group.menus.map((menu) => (
                  <li class="nav-group-item">
                    <a href={menu.path} class="nav-group-link">
                      {menu.title}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          ))
        }
      </nav>
    </div>

    <div class="footer-copyright">
      <p class="copyright-text">
        {typedSiteConfig.site.copyright} Designed & Developed by <a
          href="https://yohaku.dev"
          target="_blank"
          rel="nofollow"
        >
          yohaku
        </a>
      </p>
    </div>
  </Container>
</footer>

<style lang="scss">
  .footer {
    padding: var(--sp-3xl) 0 var(--sp-lg);
    background-color: var(--c-primary-dark);
  }

  .footer-inner {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--sp-2xl);
    margin-bottom: var(--sp-xl);

    @media (min-width: 900px) {
      grid-template-columns: repeat(2, 1fr);
      gap: var(--sp-3xl);
      margin-bottom: var(--sp-2xl);
    }
  }

  .footer-logo {
    z-index: var(--z-base);
    margin-bottom: var(--sp-md);
  }

  .footer-info {
    display: flex;
    flex-direction: column;
    gap: var(--sp-lg);
  }

  .company-info,
  .business-hours,
  .bank-info {
    display: flex;
    flex-direction: column;
    gap: var(--sp-xs);
  }

  .info-item {
    color: var(--c-text-inverse-light);
    font-size: var(--fs-sm);
    line-height: var(--lh-relaxed);

    strong {
      color: var(--c-text-inverse-lightest);
      font-weight: 600;
    }
  }

  .info-link {
    color: var(--c-text-inverse-light);
    transition: color var(--transition-fast);

    &:hover {
      color: var(--c-text-inverse);
      text-decoration: underline;
    }
  }

  .footer-business-hours {
    color: var(--c-text-inverse-lightest);
    font-size: var(--fs-sm);
  }

  .business-hours-note {
    color: var(--c-text-inverse-sub);
    font-size: var(--fs-sm);
  }

  .footer-social {
    display: flex;
    gap: var(--sp-sm);
    margin-top: var(--sp-sm);
  }

  .social-link {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    color: var(--c-text-light);
    transition: transform var(--transition-base);

    &:hover {
      transform: translateY(-2px);
    }
  }

  .footer-nav {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--sp-xl) var(--sp-lg);

    @media (min-width: 600px) {
      grid-template-columns: repeat(3, 1fr);
      gap: var(--sp-xl);
    }
  }

  .nav-group-title {
    margin-bottom: var(--sp-md);
    color: var(--c-text-inverse-lightest);
    font-size: var(--fs-sm);
    font-weight: 500;
    line-height: var(--lh-tight);
    letter-spacing: 0.05em;

    @media (min-width: 900px) {
      margin-bottom: var(--sp-lg);
      font-size: var(--fs-base);
    }
  }

  .nav-group-list {
    display: flex;
    flex-direction: column;
    gap: var(--sp-sm);
  }

  .nav-group-link {
    display: inline-block;
    color: var(--c-text-inverse-light);
    font-size: var(--fs-sm);
    line-height: var(--lh-relaxed);
    transition: color var(--transition-fast);

    &:hover {
      color: var(--c-text-inverse);
      text-decoration: underline;
    }

    @media (min-width: 900px) {
      font-size: var(--fs-base);
    }
  }

  .footer-copyright {
    padding-top: var(--sp-lg);
    border-top: 1px solid var(--c-border-inverse);

    @media (min-width: 900px) {
      padding-top: var(--sp-xl);
    }
  }

  .copyright-text {
    color: var(--c-text-inverse-sub);
    font-size: var(--fs-xs);

    @media (min-width: 900px) {
      font-size: var(--fs-sm);
    }
  }
</style>
